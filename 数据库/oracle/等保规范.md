# 等保规范



# 密码强度要求

### utlpwdmg.sql

PASSWORD_VERIFY_FUNCTION 8，密码复杂度8个字符

> 修改密码复杂度（如长度）须通过修改 utlpwdmg.sql 方式

PASSWORD_LIFE_TIME 90，口令有效期90天

PASSWORD_REUSE_MAX ５，禁止使用最近5次使用的口令

PASSWORD_GRACE_TIME 5，密码失效后锁定5分钟

FAILED_LOGIN_ATTEMPTS 5，连续输错密码5次，第6次锁定用户

```bash
[oracle@localhost response]$ cd /usr/local/oracle/product/11.2.0/db_1/rdbms/admin/
# 备份utlpwdmg.sql
[oracle@localhost admin]$ cp utlpwdmg.sql utlpwdmg.sql.bak
[oracle@localhost admin]$ vi utlpwdmg.sql
```

修改`PASSWORD_LIFE_TIME`/`PASSWORD_REUSE_MAX`/`PASSWORD_GRACE_TIME`/`FAILED_LOGIN_ATTEMPTS`参数

```sql
ALTER PROFILE DEFAULT LIMIT
PASSWORD_LIFE_TIME 90
PASSWORD_GRACE_TIME 5
PASSWORD_REUSE_TIME UNLIMITED
PASSWORD_REUSE_MAX 5
FAILED_LOGIN_ATTEMPTS 5
PASSWORD_LOCK_TIME 1
PASSWORD_VERIFY_FUNCTION verify_function_11G;
```

修改密码长度

```sql
   -- Check for the minimum length of the password
   IF length(password) < 8 THEN
      raise_application_error(-20001, 'Password length less than 8');
   END IF;
```

执行 utlpwdmg.sql

```sql
[oracle@localhost admin]$ sqlplus SYS/123456 as sysdba

SQL*Plus: Release 11.2.0.1.0 Production on Fri Jul 30 11:42:55 2021

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

SQL> @utlpwdmg.sql

Function created.


Profile altered.


Function created.
```



### Alter 修改参数

`PASSWORD_LIFE_TIME`/`PASSWORD_REUSE_MAX`/`PASSWORD_GRACE_TIME`/`FAILED_LOGIN_ATTEMPTS`等参数可以使用 alter 修改

```sql
alter profile default limit FAILED_LOGIN_ATTEMPTS 5;
```



### 查询参数

```sql
select * FROM dba_profiles s Where s.profile='DEFAULT' AND resource_name='PASSWORD_LIFE_TIME';
```

# 使用自建角色管理数据库

不使用系统角色 DBA（CONNECT、RESOURCE），使用自建的角色对用户进行粒度更细的权限管理

> 参看 [自建角色授权](/数据库/oracle/sqlplus?id=自建角色授权)

